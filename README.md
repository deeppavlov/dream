# Dream Robot

## Запуск

Как запустить роботический дистрибутив **Dream** (dream_embodied):

1. Склонировать **Dream** в удобную директорию на серверной машине командой ```git clone --branch demo/embodied https://github.com/deeppavlov/dream.git```
2. Склонировать коннектор для виртуальных миров в удобную директорию на клиентской машине командой ```git clone https://github.com/deeppavlov/minecraft-interface.git```
3. Получить токен для бота в телеграм, следуя инструкции https://t.me/botfather
4. В окне терминала, в котором будет далее запущен **Dream** на серверной машине ввести команду
```export $TG_TOKEN=...```, вставив вместо многоточия токен бота, полученный на предыдущем шаге
5. Зайти в корневую директорию **Dream** на серверной машине
6. Ввести команду для запуска **Dream** на серверной машине (см. приложение)
7. Открыть окно терминала на клиентской машине
8. Зайти в корневую директорию коннектора на клиентской машине
9. Ввести команду ```pip install -r requirements.txt``` на клиентской машине
10. Ввести команду ```python3 server.py --ip 0.0.0.0 --server_ip lnsigo.mipt.ru --server_port 14000 --port 8339 --conn game_blank``` на клиентской машине

## Приложение

### Команда для запуска:

```shell
docker-compose -f docker-compose.yml -f assistant_dists/dream_embodied/docker-compose.override.yml -f assistant_dists/dream_embodied/proxy.yml -f assistant_dists/dream_embodied/dev.yml build && docker-compose -f docker-compose.yml -f assistant_dists/dream_embodied/docker-compose.override.yml -f assistant_dists/dream_embodied/proxy.yml -f assistant_dists/dream_embodied/dev.yml up --force-recreate
```

### Примечание

- Если предполагается запуск **Dream** на компьютерах МФТИ, то для корректной работы проекта на клиентской машине должен быть подключён лабораторный **VPN**
- Если предполагается запуск **Dream** на любых других устройствах, необходимо во-первых опубликовать на серверной машине 6000 порт (с маппингом на 14000, либо поменять аргумент ```—-server_port``` из команды на шаге 10 на 6000), и во-вторых обеспечить к нему доступ извне (если предполагается, что клиентская и серверная машина будут не в одной локальной сети)
- Если предполагается запуск **Dream** и клиента на любых нелабораторных устройствах, находящихся в пределах одной локальной сети, необходимо опубликовать на серверной машине 6000 порт, соответствующе на ней настроить фаервол, и в команде с шага 10 поменять аргумент ```--server_ip``` на локальный адрес серверной машины и аргумент ```--server_port``` на публичный порт серверной машины
- После шага 6 нужно дождаться, пока в соответствующем окне терминала не появится сообщение, содержащее в себе строку *start polling*
- После шага 10 в соответствующем окне консоли должны каждые несколько секунд появляться сообщения о послании запросов в **Dream**. Если всё успешно, то каждый запрос должен возвращать код 200

### Тестирование

1. В телеграм написать ранее созданному боту сообщение *move_forward* или *move_backward*
2. Получить ответ от бота и наблюдать на клиентской машине в окне терминала с запущенной командой из шага 10 сообщение о получении соответствующей команды